# オンライン処理方針概要設計書

**HDBモバイルアプリケーション**

---

## 改訂履歴

| 版数 | 版改訂日 | 変更箇所 | 変更理由 | 変更内容 | 変更者 | 承認者 |
|------|----------|----------|----------|----------|---------|---------|
| 1.0 | 2025/08/01 | 初版発行 | 新規作成 | HDBモバイルアプリのオンライン処理方針を策定 | HDBプロジェクトチーム | |

---

## 目次

### 第1章. オンライン処理方針
1.1. オンライン処理方針  
1.2. 性能設計方針

### 第2章. オンライン処理方式設計
2.1. 文字処理方式  
2.2. 性能処理方式  
2.3. 可用性処理方式  
2.4. 運用処理方式  
2.5. セキュリティ処理方式  
2.6. 通信処理方式  
2.7. データ保護処理方式  
2.8. サービス監視処理方式  
2.9. 負荷分散処理方式  
2.10. サービス継続処理方式  
2.11. リカバリ処理方式  
2.12. 閉塞・予閉塞処理方式  
2.13. 標準処理方式  
2.14. システム基盤制御ツール  
2.15. 運用作業支援ツール

---

## 第1章. オンライン処理方針

### 1.1. オンライン処理方針

本設計書は、HDBモバイルアプリケーションにおけるオンライン処理の仕組みとして、文字、性能、可用性、運用、セキュリティ、通信方式、データ保護、サービス監視、負荷分散、サービス継続、リカバリ、閉塞、予閉塞、標準、システム基盤制御ツール、運用作業支援ツールについて網羅的に整理し、検証可能にすることを目的とする。

#### 基本方針

1. **24時間365日稼働**を前提とした高可用性設計
2. **クロスプラットフォーム対応**（iOS/Android）
3. **セキュアな通信**とデータ保護の実現
4. **高性能**かつ**省リソース**な処理の実現
5. **運用の自動化**と監視体制の確立

#### 前提条件

- React Nativeによるクロスプラットフォーム開発
- iOS16以降、Android10以降のサポート
- HDBシステムおよびバイタルAWSとの連携
- SQLiteによるローカルデータベース実装
- 24時間365日稼働を前提とした設計

### 1.2. 性能設計方針

#### 性能目標値

| 項目 | 目標値 | 測定条件 |
|------|--------|----------|
| アプリ起動時間 | 初回：3秒以内<br>2回目以降：1秒以内 | 90%ile |
| 画面遷移時間 | 0.5秒以内 | WebView画面除く、90%ile |
| API応答時間 | 2秒以内 | 95%ile |
| 同時接続数 | 1000接続/分 | アプリ側の制限 |
| CPU使用率 | 50%以下 | 通常操作時 |
| メモリ使用量 | 200MB以下 | アプリ単体 |
| 通信量 | 50MB/日 | データ圧縮により削減 |

---

## 第2章. オンライン処理方式設計

### 2.1. 文字処理方式

#### 2.1.1. 文字処理 機能

文字コードおよび入力文字に関する処理方式を定義する。

**基本仕様**
- 文字コード：UTF-8（全システム統一）
- 改行コード：LF（\n）iOS/Android共通
- エンコーディング：UTF-8 without BOM

#### 2.1.2. 文字処理 入力制限

| 項目 | 最大文字数 | 制限事項 |
|------|------------|----------|
| ユーザーID | 50文字 | 半角英数字のみ |
| パスワード | 20文字 | 8-20文字、英数字記号混在必須 |
| ニックネーム | 20文字 | 全角10文字相当 |
| テキスト入力 | 1000文字 | 備考欄等 |

#### 2.1.3. 文字処理 セキュリティ対策

**禁止文字**
- 制御文字（NULL、改行除く）
- SQLインジェクション対策文字

**エスケープ処理**
- HTMLエンティティ：`<>&"'` をエスケープ
- SQLパラメータバインディングの使用

### 2.2. 性能処理方式

#### 2.2.1. 性能処理 機能

アプリケーションの性能要件と実現方式を定義する。

#### 2.2.2. 性能処理 最適化手法

**起動時間の最適化**
1. 遅延ロード（Lazy Loading）の実装
2. 必要最小限のモジュール読み込み
3. スプラッシュスクリーン中の初期化処理

**メモリ使用量の最適化**
1. 不要なオブジェクトの即時解放
2. 画像のキャッシュ管理
3. メモリリークの防止

### 2.3. 可用性処理方式

#### 2.3.1. 可用性処理 機能

システムの可用性を確保するための処理方式を定義する。

**稼働率目標**
- 99.9%（年間ダウンタイム：8.76時間以内）

#### 2.3.2. 可用性処理 実現方式

1. **オフライン対応**
   - ローカルDB（SQLite）によるデータ保持
   - オンライン復帰時の自動同期

2. **エラーハンドリング**
   - グレースフルデグラデーション
   - ユーザーフレンドリーなエラーメッセージ

### 2.4. 運用処理方式

#### 2.4.1. 運用処理 機能

日常運用およびメンテナンスに関する処理方式を定義する。

#### 2.4.2. 運用処理 ログ管理

**ログ出力レベル**
- ERROR：エラー情報
- WARN：警告情報
- INFO：一般情報
- DEBUG：デバッグ情報（開発環境のみ）

**ログ保持期間**
- アプリ内：7日間
- サーバー側：1年間

### 2.5. セキュリティ処理方式

#### 2.5.1. セキュリティ処理 機能

アプリケーションのセキュリティを確保するための処理方式を定義する。

#### 2.5.2. セキュリティ処理 認証・認可

**認証方式**
- ID/パスワード認証
- 生体認証（Face ID/Touch ID/指紋）
- 二要素認証（将来実装）

**セッション管理**
- JWTトークンによる認証状態管理
- トークン有効期限：24時間
- リフレッシュトークン：30日間

#### 2.5.3. セキュリティ処理 データ暗号化

**通信路暗号化**
- TLS 1.3以上
- 証明書ピンニング（将来実装）

**保存データ暗号化**
- Keychain（iOS）/Keystore（Android）による機密情報保護
- SQLite暗号化（SQLCipher）

### 2.6. 通信処理方式

#### 2.6.1. 通信処理 機能

外部システムとの通信に関する処理方式を定義する。

#### 2.6.2. 通信処理 プロトコル

**通信プロトコル**
- HTTPS（REST API）
- WebSocket（リアルタイム通信、将来実装）

**通信方式**
- 非同期通信
- リトライ機能（指数バックオフ）
- タイムアウト：30秒

#### 2.6.3. 通信処理 データフォーマット

**リクエスト/レスポンス形式**
- JSON形式
- Content-Type: application/json
- 文字コード：UTF-8

### 2.7. データ保護処理方式

#### 2.7.1. データ保護処理 機能

データの完全性と機密性を保護するための処理方式を定義する。

#### 2.7.2. データ保護処理 バックアップ

**自動バックアップ**
- iCloud（iOS）/Google Drive（Android）
- 日次バックアップ
- 世代管理：3世代

**データ整合性チェック**
- チェックサム検証
- トランザクション管理

### 2.8. サービス監視処理方式

#### 2.8.1. サービス監視処理 機能

アプリケーションの稼働状況を監視するための処理方式を定義する。

#### 2.8.2. サービス監視処理 監視項目

**監視対象**
- API応答時間
- エラー発生率
- クラッシュ率
- ANR（Application Not Responding）発生率

**監視ツール**
- Firebase Crashlytics
- Firebase Performance Monitoring
- カスタムメトリクス

### 2.9. 負荷分散処理方式

#### 2.9.1. 負荷分散処理 機能

サーバー側の負荷を分散するための処理方式を定義する。

#### 2.9.2. 負荷分散処理 実装方式

**クライアント側制御**
- API呼び出しの間隔制御
- バッチ処理による一括送信
- キャッシュの活用

**レート制限**
- 1分間あたり60リクエスト
- バースト制限：10リクエスト/秒

### 2.10. サービス継続処理方式

#### 2.10.1. サービス継続処理 機能

障害発生時でもサービスを継続するための処理方式を定義する。

#### 2.10.2. サービス継続処理 フェイルオーバー

**オフラインモード**
- ローカルDBでの継続動作
- 必須機能の維持
- データ同期キューイング

**縮退運転**
- 最小限機能での動作継続
- リードオンリーモード

### 2.11. リカバリ処理方式

#### 2.11.1. リカバリ処理 機能

障害からの復旧に関する処理方式を定義する。

#### 2.11.2. リカバリ処理 復旧手順

**自動復旧**
- アプリクラッシュ後の自動再起動
- 未送信データの再送
- 同期状態の復元

**手動復旧**
- キャッシュクリア機能
- データ再同期機能
- 設定リセット機能

### 2.12. 閉塞・予閉塞処理方式

#### 2.12.1. 閉塞処理 機能

サービスの計画的な停止と緊急停止に関する処理方式を定義する。

#### 2.12.2. 閉塞処理 実装方式

**計画メンテナンス**
- アプリ内告知機能
- グレースフルシャットダウン
- メンテナンスモード画面

**緊急閉塞**
- Remote Config による即時停止
- エラーメッセージ表示
- 最小限の情報提供

### 2.13. 標準処理方式

#### 2.13.1. 標準処理 機能

アプリケーション全体で統一すべき標準的な処理方式を定義する。

#### 2.13.2. 標準処理 コーディング規約

**命名規則**
- TypeScript/JavaScript: camelCase
- コンポーネント: PascalCase
- 定数: UPPER_SNAKE_CASE

**エラー処理**
- Try-Catch による例外補足
- エラーバウンダリーの実装
- 統一エラーレスポンス形式

### 2.14. システム基盤制御ツール

#### 2.14.1. 開発ツール

**ビルド・デプロイツール**
- Metro Bundler
- Xcode / Android Studio
- Fastlane（CI/CD）

**デバッグツール**
- React Native Debugger
- Flipper
- Chrome DevTools

### 2.15. 運用作業支援ツール

#### 2.15.1. 監視・分析ツール

**パフォーマンス監視**
- Firebase Performance Monitoring
- 自作パフォーマンスロガー

**ユーザー行動分析**
- Firebase Analytics
- カスタムイベントトラッキング

**リモート設定**
- Firebase Remote Config
- Feature Flag管理

---

## 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| ANR | Application Not Responding：アプリケーションが応答しない状態 |
| JWT | JSON Web Token：認証トークンの形式 |
| SQLCipher | SQLiteの暗号化拡張 |
| TLS | Transport Layer Security：通信暗号化プロトコル |

### B. 参考資料

1. React Native公式ドキュメント
2. iOS Human Interface Guidelines
3. Material Design Guidelines
4. OWASP Mobile Security