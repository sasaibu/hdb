# HDBモバイルアプリ ソフトウェアフレームワーク機能一覧

## 文書情報
- **文書名**: HDBモバイルアプリ ソフトウェアフレームワーク機能一覧
- **作成日**: 2025-08-01
- **更新日**: 2025-08-01
- **作成者**: HDBプロジェクトチーム
- **対象**: フレームワーク利用者（開発者）、設計・実装者
- **バージョン**: 3.0

## 目次

### 基盤機能
1. [データベースアクセス機能](#データベースアクセス機能)
2. [認証管理機能](#認証管理機能)
3. [エラーハンドリング機能](#エラーハンドリング機能)

### アプリケーション機能
4. [API通信統合機能](#api通信統合機能) 🆕
5. [バイタルデータ管理機能](#バイタルデータ管理機能)
6. [目標・達成管理機能](#目標達成管理機能) 🆕
7. [ミッション管理機能](#ミッション管理機能) 🆕

### 統合機能
8. [Firebase統合機能](#firebase統合機能)
9. [ヘルスケア連携機能](#ヘルスケア連携機能)
10. [WebView統合機能](#webview統合機能)

### 運用支援機能
11. [データ移行・バックアップ機能](#データ移行バックアップ機能) 🆕
12. [通知統合管理機能](#通知統合管理機能) 🆕
13. [バッチ処理フレームワーク](#バッチ処理フレームワーク)

### セキュリティ機能
14. [生体認証機能](#生体認証機能) 🆕

### その他
15. [その他の共通機能](#その他の共通機能)

### 実装ステータス凡例
- ✅ 実装済み
- 🚧 部分実装
- 📋 設計済み・未実装

---

## データベースアクセス機能 ✅

### 概要

#### 機能概要
- SQLiteを利用したローカルデータベースアクセス機能である。
- トランザクション管理、マイグレーション機能を内包したDatabaseServiceを提供する。
- シングルトンパターンを採用し、アプリケーション全体で単一のDB接続を保証する。
- 型安全なクエリビルダーとORMライクなデータアクセスを提供する。
- 非同期処理に対応し、UIスレッドをブロックしない設計となっている。

#### 概念図
```
┌─────────────────┐
│  Application    │
└────────┬────────┘
         │
┌────────▼────────┐
│ DatabaseService │ ← シングルトン
├─────────────────┤
│ - instance      │
│ - database      │
│ - initialize()  │
│ - execute()     │
└────────┬────────┘
         │
┌────────▼────────┐
│  SQLite DB      │
└─────────────────┘
```

### 解説
- DatabaseServiceはシングルトンパターンで実装され、アプリケーション全体で一つのインスタンスを共有する。
- 初回アクセス時に自動的にデータベースの初期化とマイグレーションが実行される。
- すべてのDB操作は非同期で実行され、Promiseベースのインターフェースを提供する。
- トランザクション管理は自動化されており、エラー時は自動的にロールバックされる。
- 開発環境ではDatabaseDebuggerユーティリティによるデバッグ支援機能が利用可能。

### 使用方法

#### コーディングポイント

##### 基本的な使用方法
```typescript
// DatabaseServiceのインスタンス取得
const db = DatabaseService.getInstance();

// SELECT文の実行
const results = await db.executeSql(
  'SELECT * FROM vital_data WHERE type = ? ORDER BY measured_at DESC',
  ['weight']
);

// INSERT文の実行（新統合テーブル設計対応）
await db.executeSql(
  'INSERT INTO vital_data (measurement_code, value1, value2, value3, measured_at, source) VALUES (?, ?, ?, ?, ?, ?)',
  [1100, 65.5, null, null, new Date().toISOString(), 'manual']
);
```

##### トランザクション処理
```typescript
// 自動トランザクション（エラー時は自動ロールバック）
try {
  await db.transaction(async (tx) => {
    await tx.executeSql('INSERT INTO vital_data ...');
    await tx.executeSql('UPDATE targets ...');
  });
} catch (error) {
  // トランザクションは自動的にロールバックされる
  console.error('Transaction failed:', error);
}
```

##### マイグレーション定義
```typescript
// migrations/001_initial.ts
export const migration001 = {
  version: 1,
  up: async (db: SQLiteDatabase) => {
    // 統合バイタルデータテーブル（新ER図準拠）
    await db.executeSql(`
      CREATE TABLE IF NOT EXISTS vital_data (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        measurement_code INTEGER NOT NULL,
        value1 REAL,
        value2 REAL,
        value3 REAL,
        measured_at TEXT NOT NULL,
        source TEXT NOT NULL,
        device_name TEXT,
        sync_status INTEGER DEFAULT 0
      )
    `);
    
    // 測定項目コードマスター
    await db.executeSql(`
      CREATE TABLE IF NOT EXISTS measurement_codes (
        code INTEGER PRIMARY KEY,
        name TEXT NOT NULL,
        unit TEXT,
        category TEXT
      )
    `);
    
    // 日次集計テーブル
    await db.executeSql(`
      CREATE TABLE IF NOT EXISTS daily_steps (
        date TEXT PRIMARY KEY,
        total_steps INTEGER,
        data_source TEXT
      )
    `);
  }
};
```

### 測定項目コード体系
| コード | 項目名 | 単位 | 値の格納 |
|--------|--------|------|----------|
| 1000 | 歩数 | 歩 | value1に格納 |
| 1100 | 体重 | kg | value1に格納 |
| 1110 | 体脂肪率 | % | value1に格納 |
| 1200 | 体温 | ℃ | value1に格納 |
| 1300 | 血圧 | mmHg | value1:収縮期、value2:拡張期 |
| 1400 | 心拍数 | bpm | value1に格納 |

### 拡張ポイント
- カスタムマイグレーションの追加
- クエリビルダーの拡張
- カスタムデータ型の変換処理
- 新規測定項目コードの追加

### 関連機能
- VitalDataService（バイタルデータ管理）
- DatabaseDebugger（デバッグ支援）
- SyncService（クラウド同期）

### 備考
- SQLiteのバージョンはプラットフォームに依存
- 最大データベースサイズは端末のストレージ容量に依存

---

## API通信統合機能 🚧

### 概要

#### 機能概要
- HDBサーバーおよびバイタルAWSとの統一的なAPI通信を管理する機能である。
- 認証状態確認、データ送受信、エラーハンドリングを一元化する。
- オフライン時のキューイングとリトライ機能を提供する。
- APIレスポンスの型安全性を保証する。

#### 概念図
```
┌─────────────────┐
│  Application    │
├─────────────────┤
│   ApiClient     │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌───▼───┐
│ HDB   │ │Vital │
│Server │ │ AWS  │
└───────┘ └───────┘
```

### 解説
- ApiClientがすべてのHTTP通信を一元管理する。
- 認証トークンの自動付与とリフレッシュを行う。
- ネットワークエラー時の自動リトライとキューイングを実装する。
- TypeScriptの型定義により、APIレスポンスの型安全性を保証する。

### 使用方法

#### コーディングポイント

##### 基本的なAPI呼び出し
```typescript
// 認証状態確認
const authStatus = await ApiClient.checkAuthStatus();

// バイタルデータ一括登録
const vitalData = [
  { measurementCode: 1000, value1: 10000, measuredAt: new Date() },
  { measurementCode: 1100, value1: 65.5, measuredAt: new Date() }
];
await ApiClient.registerVitalDataBatch(vitalData);

// 目標情報の取得・更新
const goals = await ApiClient.getGoals();
await ApiClient.updateGoal(goalId, { targetValue: 10000 });
```

##### ランキング取得
```typescript
// 歩数ランキング取得
const ranking = await ApiClient.getStepRanking({
  period: 'daily', // daily | weekly | monthly
  date: new Date()
});
```

### 拡張ポイント
- 新規APIエンドポイントの追加
- カスタムインターセプターの実装
- レスポンスキャッシュ戦略の変更

### 関連機能
- AuthService（認証管理）
- QueueService（オフラインキュー）
- ErrorReporter（エラー収集）

### 備考
- APIタイムアウトは30秒
- 自動リトライは3回まで

---

## 認証管理機能 ✅

### 概要

#### 機能概要
- React ContextとカスタムHookを利用した認証状態管理機能である。
- KeychainServiceと連携し、セキュアな認証情報の永続化を実現する。
- 自動的なトークンリフレッシュとセッション管理を提供する。
- ログイン状態に応じた画面遷移制御を自動化する。
- 生体認証（TouchID/FaceID）との統合をサポートする。

#### 概念図
```
┌─────────────────┐
│   Component     │
├─────────────────┤
│ useAuth() Hook  │
└────────┬────────┘
         │
┌────────▼────────┐
│  AuthContext    │
├─────────────────┤
│ - user          │
│ - isLoading     │
│ - login()       │
│ - logout()      │
└────────┬────────┘
         │
┌────────▼────────┐
│ KeychainService │← セキュアストレージ
└─────────────────┘
```

### 解説
- AuthContextがアプリケーション全体の認証状態を管理する。
- useAuthフックにより、どのコンポーネントからも認証状態にアクセス可能。
- 認証トークンはKeychainService経由でセキュアに保存される。
- アプリ起動時に自動的に認証状態が復元される。
- 認証エラー時は自動的にログイン画面へ遷移する。

### 使用方法

#### コーディングポイント

##### 認証状態の取得
```typescript
// コンポーネント内での使用
function ProfileScreen() {
  const { user, isAuthenticated } = useAuth();
  
  if (!isAuthenticated) {
    return <LoginPrompt />;
  }
  
  return <Text>ようこそ、{user.name}さん</Text>;
}
```

##### ログイン処理
```typescript
function LoginScreen() {
  const { login, isLoading } = useAuth();
  
  const handleLogin = async () => {
    try {
      await login(email, password);
      // 成功時は自動的にホーム画面へ遷移
    } catch (error) {
      Alert.alert('ログインエラー', error.message);
    }
  };
}
```

##### 保護されたルート
```typescript
// AppNavigator.tsx
function AppNavigator() {
  const { isAuthenticated } = useAuth();
  
  return (
    <Stack.Navigator>
      {isAuthenticated ? (
        <Stack.Screen name="Home" component={HomeScreen} />
      ) : (
        <Stack.Screen name="Login" component={LoginScreen} />
      )}
    </Stack.Navigator>
  );
}
```

### 拡張ポイント
- カスタム認証プロバイダーの追加
- 多要素認証の実装
- ソーシャルログインの統合

### 関連機能
- KeychainService（セキュアストレージ）
- ApiClient（認証API通信）
- BiometricService（生体認証）

### 備考
- トークンの有効期限は24時間
- リフレッシュトークンは30日間有効

---

## バイタルデータ管理機能 🚧

### 概要

#### 機能概要
- 健康データ（歩数、体重、血圧等）の統合管理機能である。
- ローカルDBとクラウドの自動同期機能を提供する。
- プラットフォーム固有のヘルスケアサービス（HealthKit/Google Fit）と連携する。
- データの集計・統計処理機能を内包する。
- オフライン時もデータ記録を継続し、オンライン復帰時に自動同期する。

#### 概念図
```
┌─────────────────┐
│  Application    │
└────────┬────────┘
         │
┌────────▼────────┐
│VitalDataService │
├─────────────────┤
│ - save()        │
│ - getLatest()   │
│ - getRange()    │
│ - sync()        │
└───┬─────────┬───┘
    │         │
┌───▼───┐ ┌───▼───┐
│Local DB│ │Cloud  │
└────────┘ └───────┘
```

### 解説
- VitalDataServiceはシングルトンパターンで実装される。
- すべてのバイタルデータ操作の中心的なインターフェースを提供する。
- ローカルDBへの保存とクラウド同期を自動的に管理する。
- データ型に応じた検証とフォーマット処理を行う。
- 統計情報（平均値、最大値、最小値等）の自動計算機能を持つ。

### 使用方法

#### コーディングポイント

##### データの保存
```typescript
const vitalService = VitalDataService.getInstance();

// 体重データの保存
await vitalService.save({
  type: 'weight',
  value: 65.5,
  unit: 'kg',
  measuredAt: new Date(),
  source: 'manual' // manual | healthkit | googlefit
});

// 血圧データの保存
await vitalService.save({
  type: 'blood_pressure',
  systolic: 120,
  diastolic: 80,
  unit: 'mmHg',
  measuredAt: new Date()
});
```

##### データの取得
```typescript
// 最新データの取得
const latestWeight = await vitalService.getLatest('weight');

// 期間指定でのデータ取得
const weeklyData = await vitalService.getRange(
  'steps',
  startDate,
  endDate
);

// 統計情報の取得
const stats = await vitalService.getStatistics(
  'weight',
  'month'
);
```

##### ヘルスケア連携
```typescript
// HealthKit/Google Fitからのインポート
await vitalService.importFromHealthKit({
  types: ['steps', 'weight', 'heart_rate'],
  startDate: lastSyncDate,
  endDate: new Date()
});
```

### 拡張ポイント
- 新しいバイタルデータ型の追加
- カスタム集計ロジックの実装
- エクスポート形式の追加

### 関連機能
- DatabaseService（データ永続化）
- SyncService（クラウド同期）
- HealthKitService/HealthConnectService（プラットフォーム連携）

### 備考
- データ保存期間は無制限（端末容量に依存）
- 同期間隔は設定により変更可能（デフォルト：1時間）

---

## 目標・達成管理機能 📋

### 概要

#### 機能概要
- ユーザーの健康目標設定と達成状況を管理する機能である。
- 日次・週次・月次の達成率を自動計算する。
- 連続達成日数のトラッキングを提供する。
- 達成時の通知やリワード機能を内包する。

#### 概念図
```
┌─────────────────┐
│  GoalService    │
├─────────────────┤
│ - setGoal()     │
│ - checkDaily()  │
│ - getProgress() │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌───▼───┐
│Targets│ │Achieve│
│  DB   │ │ments  │
└───────┘ └───────┘
```

### 解説
- user_targetsテーブルでユーザーごとの目標値を管理する。
- daily_achievementsテーブルで日次の達成状況を記録する。
- achievement_summaryテーブルで統計情報を集約する。
- 目標達成判定はリアルタイムで実行される。

### 使用方法

#### コーディングポイント

##### 目標設定
```typescript
const goalService = GoalService.getInstance();

// 歩数目標の設定
await goalService.setGoal({
  measurementCode: 1000,
  targetValue: 10000,
  period: 'daily',
  startDate: new Date(),
  endDate: null // 無期限
});
```

##### 達成状況確認
```typescript
// 今日の達成状況
const todayProgress = await goalService.getDailyProgress(new Date());
console.log(`達成率: ${todayProgress.achievementRate}%`);
console.log(`連続達成: ${todayProgress.continuousDays}日`);

// 週間サマリー
const weekSummary = await goalService.getWeeklySummary();
```

### 拡張ポイント
- カスタム目標タイプの追加
- リワードシステムの実装
- ソーシャル機能との連携

### 関連機能
- VitalDataService（バイタルデータ取得）
- NotificationService（達成通知）
- MissionService（ミッション連携）

### 備考
- 目標値は測定項目コードごとに設定可能
- 達成判定は日本時間基準

---

## ミッション管理機能 📋

### 概要

#### 機能概要
- ユーザーの健康活動を促進するミッション機能である。
- ミッションの配信、進捗管理、達成判定を行う。
- ポイントやバッジなどのリワード系を管理する。
- 期間限定ミッションや繰り返しミッションをサポートする。

#### 概念図
```
┌─────────────────┐
│ MissionService  │
├─────────────────┤
│ - getMissions() │
│ - updateProg()  │
│ - checkComplete │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌───▼───┐
│Mission│ │Reward │
│Master │ │System │
└───────┘ └───────┘
```

### 解説
- ミッションマスターから配信条件に合うミッションを取得する。
- ユーザーの活動に応じて進捗を更新する。
- 達成条件を満たした場合、リワードを付与する。
- ミッションの進捗はリアルタイムで更新される。

### 使用方法

#### コーディングポイント

##### ミッション取得
```typescript
const missionService = MissionService.getInstance();

// アクティブなミッション一覧
const activeMissions = await missionService.getActiveMissions();

// ミッション詳細
const missionDetail = await missionService.getMissionDetail(missionId);
```

##### 進捗更新
```typescript
// ミッション進捗の更新
await missionService.updateProgress({
  missionId: 'MISSION_001',
  progressValue: 5000, // 今日の歩数
  progressDate: new Date()
});

// 達成チェック
const isCompleted = await missionService.checkCompletion(missionId);
if (isCompleted) {
  const reward = await missionService.claimReward(missionId);
}
```

### 拡張ポイント
- チームミッションの実装
- イベントミッションの追加
- リワードシステムの拡充

### 関連機能
- GoalService（目標達成連携）
- NotificationService（ミッション通知）
- RewardService（リワード管理）

### 備考
- ミッションの配信はFirebase Remote Configで制御
- リワードの付与はサーバー側で検証

---

## UI コンポーネントフレームワーク ✅

### 概要

#### 機能概要
- React Nativeベースの再利用可能なUIコンポーネント群である。
- 統一されたデザインシステムとテーマ機能を提供する。
- アクセシビリティ対応が組み込まれている。
- プラットフォーム固有のスタイル調整を自動化する。
- TypeScriptによる型安全なPropsインターフェースを提供する。

#### 概念図
```
┌─────────────────┐
│  Application    │
├─────────────────┤
│   <Button />    │
│   <Card />      │
│   <Input />     │
└────────┬────────┘
         │
┌────────▼────────┐
│  Theme System   │
├─────────────────┤
│ - colors        │
│ - typography    │
│ - spacing       │
└─────────────────┘
```

### 解説
- すべてのコンポーネントはテーマシステムと統合されている。
- プラットフォーム検出により、iOS/Android固有のスタイルを自動適用する。
- アニメーションはReanimatedライブラリで最適化されている。
- コンポーネントの組み合わせにより複雑なUIを構築可能。
- ダークモード対応が標準で組み込まれている。

### 使用方法

#### コーディングポイント

##### 基本コンポーネントの使用
```typescript
// ボタンコンポーネント
<Button
  title="保存"
  onPress={handleSave}
  variant="primary"
  loading={isSaving}
/>

// カードコンポーネント
<Card title="今日の歩数" elevation={2}>
  <Text style={styles.value}>10,234歩</Text>
  <ProgressBar value={0.8} />
</Card>

// 入力コンポーネント
<Input
  label="体重"
  value={weight}
  onChangeText={setWeight}
  keyboardType="decimal-pad"
  suffix="kg"
  error={weightError}
/>
```

##### テーマの利用
```typescript
import { theme } from '@/styles/theme';

const styles = StyleSheet.create({
  container: {
    backgroundColor: theme.colors.background,
    padding: theme.spacing.medium,
  },
  title: {
    ...theme.typography.heading1,
    color: theme.colors.primary,
  }
});
```

##### カスタムコンポーネントの作成
```typescript
interface CustomCardProps {
  title: string;
  value: number;
  unit: string;
  trend?: 'up' | 'down' | 'stable';
}

export const VitalCard: React.FC<CustomCardProps> = ({
  title,
  value,
  unit,
  trend
}) => {
  return (
    <Card>
      <Text style={styles.title}>{title}</Text>
      <View style={styles.valueContainer}>
        <Text style={styles.value}>{value}</Text>
        <Text style={styles.unit}>{unit}</Text>
        {trend && <TrendIcon trend={trend} />}
      </View>
    </Card>
  );
};
```

### 拡張ポイント
- カスタムテーマの作成
- 新規コンポーネントの追加
- アニメーション効果のカスタマイズ

### 関連機能
- Theme System（デザインシステム）
- Reanimated（アニメーション）
- Gesture Handler（タッチ操作）

### 備考
- Material Design 3.0とiOS Human Interface Guidelinesに準拠
- RTL（右から左）レイアウトに対応予定

---

## エラーハンドリング機能 ✅

### 概要

#### 機能概要
- React Error Boundaryを利用した包括的なエラーハンドリング機能である。
- 未処理の例外を捕捉し、アプリケーションのクラッシュを防止する。
- エラー情報の自動収集とレポート機能を提供する。
- ユーザーフレンドリーなエラー画面を表示する。
- 開発環境では詳細なスタックトレースを提供する。

#### 概念図
```
┌─────────────────┐
│      App        │
└────────┬────────┘
         │
┌────────▼────────┐
│ ErrorBoundary   │← エラー捕捉
├─────────────────┤
│ - state.error   │
│ - logError()    │
│ - reset()       │
└────────┬────────┘
         │
┌────────▼────────┐
│ Error Reporter  │← エラー送信
└─────────────────┘
```

### 解説
- ErrorBoundaryコンポーネントがアプリケーション全体をラップする。
- JavaScriptエラーとPromiseのrejectionを自動的に捕捉する。
- エラー発生時は自動的にエラー画面を表示し、アプリの再起動オプションを提供する。
- 本番環境ではエラー情報を外部サービスに送信する。
- 開発環境では詳細なデバッグ情報を表示する。

### 使用方法

#### コーディングポイント

##### ErrorBoundaryの設定
```typescript
// App.tsx
import { ErrorBoundary } from '@/utils/ErrorHandler';

export default function App() {
  return (
    <ErrorBoundary
      onError={(error, errorInfo) => {
        // カスタムエラー処理
        console.error('App Error:', error);
      }}
      fallback={<ErrorScreen />}
    >
      <NavigationContainer>
        <AppNavigator />
      </NavigationContainer>
    </ErrorBoundary>
  );
}
```

##### エラーのスロー
```typescript
// ビジネスロジックでのエラー処理
class ValidationError extends Error {
  constructor(message: string, public field: string) {
    super(message);
    this.name = 'ValidationError';
  }
}

// 使用例
if (!isValidWeight(weight)) {
  throw new ValidationError('体重は0より大きい値を入力してください', 'weight');
}
```

##### 非同期エラーの処理
```typescript
// 非同期処理でのエラーハンドリング
const fetchData = async () => {
  try {
    const response = await api.get('/vital-data');
    return response.data;
  } catch (error) {
    // エラーを上位に伝播
    ErrorReporter.capture(error, {
      context: 'fetchVitalData',
      userId: currentUser.id
    });
    throw error;
  }
};
```

### 拡張ポイント
- カスタムエラークラスの追加
- エラーレポートサービスの変更
- エラー画面のカスタマイズ

### 関連機能
- Logger（ログ出力）
- ErrorReporter（エラー収集）
- Toast/Alert（エラー通知）

### 備考
- エラーログは本番環境でのみ外部送信される
- 個人情報を含むエラーメッセージは自動的にマスクされる

---

---

## Firebase統合機能 😧

### 概要

#### 機能概要
- Firebase各種サービスを統合的に利用するためのフレームワーク機能である。
- Push通知、Remote Config、Crashlyticsを一元的に管理する。
- 環境別（開発/本番）の設定自動切り替えを提供する。
- 初期化処理の自動化とエラーハンドリングを内包する。

#### 概念図
```
┌─────────────────┐
│  Application    │
├─────────────────┤
│ FirebaseService │
└───────┬─────────┘
        │
┌───────┼─────────┐
│       │         │
┌───▼───┐ ┌───▼───┐ ┌───▼───┐
│  FCM  │ │Config │ │Crash  │
└───────┘ └───────┘ └───────┘
```

### 解説
- アプリ起動時にFirebase SDKの初期化を自動実行する。
- Remote Configによる動的設定の取得と適用を管理する。
- FCM（Firebase Cloud Messaging）によるPush通知の受信と処理を統合する。
- Crashlyticsによるクラッシュレポートの自動収集を行う。

### 使用方法

#### コーディングポイント

##### Firebase初期化
```typescript
// App.tsx
import { FirebaseService } from '@/services/FirebaseService';

// アプリ起動時の初期化
await FirebaseService.initialize();

// Remote Config取得
const config = await FirebaseService.getRemoteConfig();
const apiEndpoint = config.getString('api_endpoint');
```

##### Push通知の設定
```typescript
// Push通知権限リクエスト
const granted = await FirebaseService.requestNotificationPermission();

// トークン取得
const fcmToken = await FirebaseService.getFCMToken();

// 通知受信リスナー
FirebaseService.onNotificationReceived((notification) => {
  console.log('Notification:', notification);
});
```

### 拡張ポイント
- Analytics統合の追加
- Performance Monitoring統合
- A/Bテスト機能の実装

### 関連機能
- NotificationService（通知管理）
- ConfigService（設定管理）
- ErrorReporter（エラー収集）

### 備考
- google-services.json（Android）、GoogleService-Info.plist（iOS）の設定が必要

---

## ヘルスケア連携機能 📋

### 概要

#### 機能概要
- iOS HealthKit、Android Health Connectとの統合連携機能である。
- プラットフォーム差異を吸収する統一インターフェースを提供する。
- 権限管理、データ取得、データ書き込みを一元化する。
- バックグラウンドでの自動同期機能を提供する。

#### 概念図
```
┌─────────────────┐
│ HealthService   │
├─────────────────┤
│ - authorize()   │
│ - readData()    │
│ - writeData()   │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌───▼───┐
│Health │ │Health │
│ Kit   │ │Connect│
└───────┘ └───────┘
```

### 解説
- プラットフォーム判定により適切なヘルスケアサービスを自動選択する。
- 権限リクエストのUIフローを統一化する。
- データ型の変換とマッピングを自動化する。
- エラー処理とリトライ機能を内包する。

### 使用方法

#### コーディングポイント

##### 権限リクエスト
```typescript
const healthService = HealthService.getInstance();

// 必要な権限をリクエスト
const permissions = ['steps', 'weight', 'heartRate'];
const granted = await healthService.requestAuthorization(permissions);
```

##### データ読み取り
```typescript
// 期間指定でデータ取得
const startDate = new Date('2025-01-01');
const endDate = new Date();

const stepsData = await healthService.readSteps(startDate, endDate);
const weightData = await healthService.readWeight(startDate, endDate);
```

##### データ書き込み
```typescript
// ヘルスケアへのデータ書き込み
await healthService.writeWeight({
  value: 65.5,
  date: new Date(),
  unit: 'kg'
});
```

### 拡張ポイント
- 新しいヘルスケアデータ型の追加
- リアルタイム同期機能
- データ変換ロジックのカスタマイズ

### 関連機能
- VitalDataService（バイタルデータ管理）
- PermissionService（権限管理）
- BackgroundTaskService（バックグラウンド処理）

### 備考
- iOS: HealthKit使用にはEntitlementsの設定が必要
- Android: Health Connect APIはAndroid 14以降で利用可能

---

## WebView統合機能 ✅

### 概要

#### 機能概要
- React Native WebViewを利用した外部Web画面統合機能である。
- HDBシステムとのシームレスな連携を実現する。
- 認証情報の自動付与とセッション管理を提供する。
- JavaScript Bridge による双方向通信を実装する。

#### 概念図
```
┌─────────────────┐
│  React Native   │
├─────────────────┤
│ WebViewWrapper  │
└────────┬────────┘
         │
┌────────▼────────┐
│    WebView      │
│  ┌───────────┐  │
│  │ HDB Web   │  │
│  └───────────┘  │
└─────────────────┘
```

### 解説
- 共通WebViewコンポーネントによる統一的なWeb画面表示を実現する。
- 認証トークンの自動付与によりシングルサインオンを実現する。
- ナビゲーション制御とエラーハンドリングを統合する。
- ローディング状態とプログレス表示を標準化する。

### 使用方法

#### コーディングポイント

##### 基本的な使用方法
```typescript
<WebViewWrapper
  url="https://hdb.example.com/stress-check"
  authRequired={true}
  onNavigationStateChange={handleNavigation}
  onMessage={handleMessage}
/>
```

##### JavaScript Bridgeの実装
```typescript
// ネイティブ → Web
webViewRef.current?.postMessage(JSON.stringify({
  type: 'updateToken',
  token: newToken
}));

// Web → ネイティブ
const handleMessage = (event: WebViewMessageEvent) => {
  const data = JSON.parse(event.nativeEvent.data);
  if (data.type === 'requestData') {
    // データ要求への対応
  }
};
```

### 拡張ポイント
- カスタムヘッダーの追加
- オフラインキャッシュ機能
- PDFダウンロード対応

### 関連機能
- AuthService（認証管理）
- NavigationService（画面遷移）
- CacheService（キャッシュ管理）

### 備考
- iOS: WKWebViewの制限事項に注意
- Android: ファイルアップロード機能には追加実装が必要

---

## データ移行・バックアップ機能 📋

### 概要

#### 機能概要
- 機種変更やユーザー転籍時のデータ移行を管理する機能である。
- iCloud/Google Oneを利用した自動バックアップを提供する。
- エクスポート・インポート機能を提供する。
- データ整合性チェックとリカバリ機能を内包する。

#### 概念図
```
┌─────────────────┐
│ MigrationService│
├─────────────────┤
│ - backup()      │
│ - restore()     │
│ - migrate()     │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌───▼───┐
│iCloud │ │Google │
│       │ │ One   │
└───────┘ └───────┘
```

### 解説
- backup_metadataテーブルでバックアップ履歴を管理する。
- migration_logテーブルでデータ移行履歴を記録する。
- プラットフォームに応じてiCloud/Google Oneを自動選択する。
- データの暗号化と圧縮を自動実行する。

### 使用方法

#### コーディングポイント

##### バックアップ処理
```typescript
const migrationService = MigrationService.getInstance();

// 手動バックアップ
const backupResult = await migrationService.createBackup({
  includeSettings: true,
  includeVitalData: true,
  encryptionKey: userKey
});

// 自動バックアップ設定
await migrationService.enableAutoBackup({
  interval: 'daily',
  time: '02:00'
});
```

##### リストア処理
```typescript
// バックアップ一覧取得
const backups = await migrationService.listBackups();

// リストア実行
await migrationService.restore({
  backupId: selectedBackup.id,
  decryptionKey: userKey,
  overwriteExisting: true
});
```

##### 転籍データ移行
```typescript
// 転籍コード生成
const migrationCode = await migrationService.generateMigrationCode();

// 転籍データ取込
await migrationService.importMigrationData(migrationCode);
```

### 拡張ポイント
- クロスプラットフォーム移行
- 差分バックアップの実装
- バックアップスケジュール管理

### 関連機能
- DatabaseService（データアクセス）
- CloudStorageService（クラウド保存）
- EncryptionService（暗号化）

### 備考
- バックアップファイルは最大30日保持
- 転籍コードの有効期限は24時間

---

## 通知統合管理機能 😧

### 概要

#### 機能概要
- Push通知、ローカル通知、お知らせを統合管理する機能である。
- 通知種別ごとのON/OFF設定を管理する。
- 通知履歴の記録と既読管理を行う。
- 通知スケジュールと配信最適化を提供する。

#### 概念図
```
┌───────────────────┐
│NotificationManager│
├───────────────────┤
│ - configure()     │
│ - send()          │
│ - getHistory()    │
└─────────┬─────────┘
            │
      ┌─────┴─────┐
      │             │
  ┌───▼───┐   ┌───▼───┐
  │  FCM  │   │ Local │
  │       │   │ Notif │
  └───────┘   └───────┘
```

### 解説
- Firebase Cloud Messagingとローカル通知を統一的に管理する。
- notification_settingsテーブルでユーザー設定を保存する。
- notification_historyテーブルで配信履歴を記録する。
- 通知タイプに応じた配信ロジックを実装する。

### 使用方法

#### コーディングポイント

##### 通知設定
```typescript
const notificationManager = NotificationManager.getInstance();

// 通知種別設定
await notificationManager.updateSettings({
  dailyReminder: true,
  goalAchievement: true,
  missionComplete: true,
  systemNotice: false
});

// 通知時間設定
await notificationManager.setReminderTime({
  type: 'daily',
  time: '09:00'
});
```

##### 通知送信
```typescript
// ローカル通知
await notificationManager.sendLocal({
  title: '目標達成！',
  body: '今日の歩数目標を達成しました！',
  data: { type: 'goal_achievement', value: 10000 }
});

// Push通知（サーバー経由）
await notificationManager.requestPush({
  userId: currentUser.id,
  type: 'weekly_summary'
});
```

##### お知らせ管理
```typescript
// お知らせ一覧取得
const notices = await notificationManager.getNotices({
  unreadOnly: true,
  limit: 20
});

// 既読マーク
await notificationManager.markAsRead(noticeIds);
```

### 拡張ポイント
- リッチ通知（画像、アクション）
- グループ通知の実装
- A/Bテスト機能

### 関連機能
- FirebaseService（FCM連携）
- UserPreferenceService（設定管理）
- AnalyticsService（通知効果測定）

### 備考
- iOSではAPNs証明書の設定が必要
- 通知履歴は90日間保持

---

## バッチ処理フレームワーク 📋

### 概要

#### 機能概要
- バックグラウンドでの定期処理を管理するフレームワーク機能である。
- ヘルスケアデータの取得、同期、集計処理を自動化する。
- エラー処理とリトライ機能を標準装備する。
- 処理履歴の記録と監視機能を提供する。

#### 概念図
```
┌─────────────────┐
│ BatchScheduler  │
├─────────────────┤
│ - register()    │
│ - execute()     │
│ - monitor()     │
└────────┬────────┘
         │
┌────────┼────────┐
│        │        │
┌▼─────┐ ┌▼─────┐ ┌▼─────┐
│Health│ │Sync  │ │Stats │
│Batch │ │Batch │ │Batch │
└──────┘ └──────┘ └──────┘
```

### 解説
- iOS Background Fetch、Android WorkManagerを統一的に利用する。
- バッチ処理の実行間隔と優先度を管理する。
- 処理の依存関係とチェーン実行をサポートする。
- バッテリー状態や通信状態に応じた実行制御を行う。

### 使用方法

#### コーディングポイント

##### バッチ処理の登録
```typescript
BatchScheduler.register({
  id: 'health-sync',
  interval: 3600, // 1時間ごと
  priority: 'high',
  constraints: {
    requiresCharging: false,
    requiresNetwork: true
  },
  task: async () => {
    await HealthService.syncLatestData();
  }
});
```

##### 日次集計バッチ
```typescript
BatchScheduler.register({
  id: 'daily-aggregation',
  schedule: '0 2 * * *', // 毎日2時
  task: async () => {
    await VitalDataService.aggregateDailyData();
    await VitalDataService.cleanupOldData();
  }
});
```

### 拡張ポイント
- カスタムスケジューラーの実装
- 分散処理対応
- 処理結果の通知機能

### 関連機能
- BackgroundTaskService（バックグラウンド処理）
- NotificationService（処理結果通知）
- LogService（処理ログ）

### 備考
- バックグラウンド処理はOSの制限を受ける
- 省電力モード時は実行間隔が延長される可能性あり

---

## 生体認証機能 📋

### 概要

#### 機能概要
- 指紋認証、Face ID、Touch IDなどの生体認証機能を提供する。
- セキュアな認証フローと代替認証方法を実装する。
- プラットフォーム差異を吸収する統一インターフェースを提供する。
- Keychain/Keystoreと連携したセキュアな情報管理を行う。

#### 概念図
```
┌─────────────────┐
│ BiometricService│
├─────────────────┤
│ - authenticate()│
│ - isAvailable() │
│ - getType()     │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌───▼───┐
│TouchID│ │FaceID │
│FingPrn│ │Camera │
└───────┘ └───────┘
```

### 解説
- デバイスの生体認証機能を検出し、利用可能な認証方式を判定する。
- 認証失敗時の代替手段（パスコード等）への切り替えを管理する。
- 認証結果をセキュアに保存し、アプリ内での再認証を最小化する。
- プライバシーに配慮したエラーメッセージを提供する。

### 使用方法

#### コーディングポイント

##### 生体認証の実装
```typescript
const biometricService = BiometricService.getInstance();

// 生体認証の可用性チェック
const isAvailable = await biometricService.isAvailable();
const biometryType = await biometricService.getBiometryType();

// 認証実行
if (isAvailable) {
  const result = await biometricService.authenticate({
    promptMessage: 'アプリにアクセスするには認証が必要です',
    fallbackLabel: 'パスコードを使用',
    cancelLabel: 'キャンセル'
  });
  
  if (result.success) {
    // 認証成功
    navigation.navigate('Home');
  } else if (result.error === 'UserFallback') {
    // パスコード認証へ
    navigation.navigate('PasscodeLogin');
  }
}
```

##### セキュア情報の保存
```typescript
// 生体認証で保護された情報の保存
await biometricService.setSecureItem({
  key: 'auth_token',
  value: authToken,
  accessLevel: 'BiometryCurrentSet'
});

// 保護された情報の取得
const token = await biometricService.getSecureItem('auth_token');
```

### 拡張ポイント
- 新しい生体認証方式への対応
- 複合認証（生体＋PIN）の実装
- 認証履歴の管理機能

### 関連機能
- KeychainService（セキュア保存）
- AuthService（認証管理）
- SecurityService（セキュリティ全般）

### 備考
- iOS: Face ID使用には NSFaceIDUsageDescription の設定が必要
- Android: 指紋認証はAPI Level 23以降で利用可能

---

## その他の共通機能 ✅

### 概要

React Native標準コンポーネントを拡張した便利機能群を提供する。アプリケーション全体で利用される共通ユーティリティとヘルパー関数を含む。

### 含まれる機能
- 日付・時刻フォーマッター
- 数値フォーマッター（単位変換含む）
- バリデーションヘルパー
- 文字列操作ユーティリティ
- プラットフォーム判定ヘルパー
- デバイス情報取得
- ネットワーク状態監視
- パーミッション管理

### 使用例
```typescript
// 日付フォーマット
const formatted = DateUtils.format(new Date(), 'YYYY年MM月DD日');

// 数値フォーマット
const weight = NumberUtils.format(65.5, { unit: 'kg', decimal: 1 });

// バリデーション
const isValid = Validators.isValidEmail(email);

// デバイス情報
const deviceInfo = DeviceUtils.getInfo();
```

---

## まとめ

本ソフトウェアフレームワーク機能一覧（Version 3.0）は、HDBモバイルアプリケーションで利用可能なフレームワーク機能を体系的に整理したものです。

### Version 3.0の主要更新内容
- **API通信統合機能**: HDBサーバー・バイタルAWSとの統一的なAPI通信管理
- **目標・達成管理機能**: ユーザーの健康目標設定と達成状況管理
- **ミッション管理機能**: 企業管理者向けミッション配信と個人ミッション管理
- **データ移行・バックアップ機能**: 機種変更時のデータ移行とクラウドバックアップ
- **通知統合管理機能**: Push通知、ローカル通知、お知らせの統合管理
- **生体認証機能**: Face ID、Touch ID、指紋認証への対応

### Version 2.0からの改善点
- 仕様書との整合性を確認し、欠落していた機能を追加
- 測定項目コード体系（1000番台）に準拠した実装例を追加
- Firebase統合機能とヘルスケア連携機能の実装状況を更新
- セキュリティ要件に基づく生体認証機能の追加

各機能は独立性を保ちながら、相互に連携して動作するよう設計されています。開発者は本一覧を参照することで、必要な機能を迅速に見つけ、適切に実装することができます。