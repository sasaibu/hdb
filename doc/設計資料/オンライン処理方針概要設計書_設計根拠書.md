# オンライン処理方針概要設計書 設計根拠書

## 文書情報
- **文書名**: オンライン処理方針概要設計書 設計根拠書
- **作成日**: 2025-08-01
- **作成者**: HDBプロジェクトチーム
- **目的**: オンライン処理方針の15項目について、なぜこの設計にしたのかを説明

## 1. 全体設計思想

### 1.1 15項目構成の理由

要求された15項目（文字、性能、可用性、運用、セキュリティ、通信方式、データ保護、サービス監視、負荷分散、サービス継続、リカバリ、閉塞、予閉塞、標準、システム基盤制御ツール、運用作業支援ツール）は、**オンラインシステムの品質特性を網羅的にカバー**するために選定されました。

これは**ISO/IEC 25010（システム品質モデル）**の考え方に基づき、以下の観点を包含：
- 機能適合性（文字処理、通信方式）
- 性能効率性（性能、負荷分散）
- 信頼性（可用性、リカバリ、サービス継続）
- セキュリティ（セキュリティ、データ保護）
- 保守性（運用、標準、ツール）

## 2. 各項目の設計根拠

### 2.1 文字処理

#### UTF-8採用の理由
- **国際標準**：世界中で最も使用される文字エンコーディング
- **日本語対応**：漢字・ひらがな・カタカナを効率的に表現
- **将来性**：英語・中国語展開時も変更不要
- **互換性**：iOS/Android/Webすべてでネイティブサポート

#### 文字数制限の根拠
| 項目 | 制限 | 根拠 |
|------|------|------|
| ユーザーID | 50文字 | メールアドレスの実用的な最大長 |
| パスワード | 8-20文字 | セキュリティと使いやすさのバランス |
| テキスト入力 | 1000文字 | モバイルでの入力現実性とDB効率 |

### 2.2 性能

#### 起動時間3秒の根拠
- **Google推奨値**：モバイルアプリの起動は3秒以内
- **ユーザー離脱率**：3秒を超えると離脱率が急増
- **競合アプリ調査**：医療系アプリの平均値

#### API応答2秒の根拠
- **Nielsen Norman Group研究**：2秒以内でユーザーは「速い」と感じる
- **医療現場のニーズ**：診察中の待ち時間は最小限に

### 2.3 可用性

#### 稼働率99.9%の根拠
- **年間停止時間**：8.76時間（月43分）
- **医療サービス水準**：健康記録の継続性を考慮
- **コストバランス**：99.99%は過剰投資

#### MTTR 2時間の根拠
- **ユーザー影響**：1日の記録周期を考慮
- **運用体制**：24時間監視なしでも対応可能
- **SLA標準**：BtoCサービスの一般的な値

### 2.4 運用

#### ログ保持期間1年の根拠
- **医療記録の特性**：年次健診サイクルに対応
- **法規制対応**：個人情報関連の監査要求
- **ストレージコスト**：圧縮により現実的なコスト

#### インシデント対応時間の根拠
- **レベル1（翌営業日）**：ユーザー影響が限定的
- **レベル2（4時間）**：複数ユーザーに影響
- **レベル3（1時間）**：全ユーザーに影響

### 2.5 セキュリティ

#### TLS 1.3採用の理由
- **最新標準**：2018年標準化、脆弱性なし
- **高速化**：ハンドシェイク時間が1.2より短縮
- **必須化動向**：Apple/Googleが推奨

#### AES-256-GCM採用の理由
- **医療データ標準**：HIPAA準拠
- **認証付き暗号**：改竄検知機能内蔵
- **ハードウェア支援**：モバイルCPUで高速処理

### 2.6 通信方式

#### RESTful API採用の理由
- **業界標準**：開発者の学習コスト最小
- **ステートレス**：スケーラビリティ確保
- **キャッシュ活用**：オフライン対応が容易

#### タイムアウト30秒の理由
- **モバイル通信環境**：地下鉄等での一時的な通信断
- **ユーザー体験**：これ以上は離脱リスク大

### 2.7 データ保護

#### 日次バックアップの理由
- **データ量**：1日の健康記録は数KB程度
- **復旧要求**：1日前までの復旧で実用上問題なし
- **コスト効率**：リアルタイムは過剰

### 2.8 サービス監視

#### 1分間隔の死活監視の理由
- **検知時間**：最大2分で異常検知（監視間隔＋猶予）
- **誤検知防止**：瞬間的な通信断を除外
- **監視負荷**：システムへの影響最小

### 2.9 負荷分散

#### クライアント側制御の理由
- **サーバー負荷軽減**：不要なリクエストを送信前に制御
- **レスポンス向上**：ローカル処理で即座に対応
- **コスト削減**：サーバー側LB不要

### 2.10 サービス継続

#### オフラインファーストの理由
- **医療記録の重要性**：通信断でも記録継続必須
- **日本の通信環境**：地下鉄、山間部でも利用
- **ユーザビリティ**：「記録できなかった」を防ぐ

### 2.11 リカバリ

#### RPO 1営業日の理由
- **実用性**：健康記録は日次単位が基本
- **コスト**：リアルタイムレプリケーションは高額
- **リスク許容度**：1日分の再入力は許容範囲

### 2.12 閉塞・予閉塞

#### 3日前通知の理由
- **ユーザー準備期間**：データエクスポート等の時間確保
- **業界慣習**：金融・医療系の標準的な通知期間
- **記憶定着**：1週間前だと忘れられる

### 2.13 標準

#### ESLint/Prettier採用の理由
- **業界デファクト**：React Native開発の標準
- **自動化**：コードレビュー負荷軽減
- **品質均一化**：開発者スキル差を吸収

### 2.14 システム基盤制御ツール

#### Firebase採用の理由
- **統合プラットフォーム**：監視・分析・配信を一元化
- **Google品質**：高い信頼性とSLA
- **コスト効率**：小規模なら無料枠で運用可能

### 2.15 運用作業支援ツール

#### 自動化重視の理由
- **人的ミス削減**：手動運用の80%を自動化
- **24時間対応**：夜間・休日も自動対応
- **コスト削減**：運用要員の最小化

## 3. 医療系アプリ特有の設計配慮

### 3.1 データの永続性重視
- ローカルファースト設計
- 多重バックアップ
- 暗号化の徹底

### 3.2 可用性とセキュリティのバランス
- オフライン対応しつつ、セキュリティは妥協しない
- 利便性を保ちながら、医療データを保護

### 3.3 監査・コンプライアンス対応
- 全操作ログの記録
- 長期保存対応
- トレーサビリティ確保

## 4. 将来拡張を考慮した設計

### 4.1 多言語対応準備
- UTF-8による国際化対応
- リソースファイル分離設計

### 4.2 スケーラビリティ
- ステートレス設計
- 水平スケール可能な構成

### 4.3 新技術への対応
- 標準規格の採用
- 疎結合アーキテクチャ

## 5. コスト最適化の観点

### 5.1 段階的投資
- 初期は最小構成
- 利用者増に応じて拡張

### 5.2 クラウドネイティブ
- 従量課金モデル活用
- 自動スケーリング

### 5.3 運用自動化
- 人件費削減
- 24時間対応を低コストで実現

## 6. まとめ

本設計書は、HDBモバイルアプリが**医療系アプリとして求められる高い要求**を満たしつつ、**現実的なコストで実現可能**な設計としています。

各項目の数値や方式は、以下の観点でバランスを取って決定：
1. **医療データの重要性**（可用性、永続性）
2. **ユーザビリティ**（性能、オフライン対応）
3. **セキュリティ要求**（暗号化、認証）
4. **運用現実性**（自動化、コスト）
5. **将来拡張性**（標準準拠、国際化）

これにより、**エンドユーザー**、**医療機関**、**運用チーム**すべてのステークホルダーにとって価値のあるシステムを実現します。