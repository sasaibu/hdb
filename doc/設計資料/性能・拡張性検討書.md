# HDBアプリケーション 性能・拡張性検討書

文書管理情報
- 作成日：2025-08-08
- 版数：3.0
- 作成者：開発チーム
- 対象プロジェクト：ヘルスデータバンク（HDB）スマートフォンアプリ

1. 概要

1.1 目的
本文書は、HDBスマートフォンアプリケーションの性能・拡張性要求、各種処理方式性能設計、性能設計方針、必要HW製品スペック、想定する拡張範囲、拡張対策について網羅的に整理し、検証可能な仕様として定義することを目的とする。

1.2 対象システム概要
- システム名：HDBアプリケーション（iOS/Android）
- 技術スタック：React Native 0.80.0 + TypeScript 5.0.4
- データベース：SQLite（react-native-sqlite-2）+ Keychain/Keystore + AsyncStorage
- 外部連携：バイタルAWS（専用API）、HDBシステム（WebView経由SSO）、Firebase（Remote Config、FCM）、HealthKit（iOS）/ヘルスコネクト（Android）
- 開発状況：Mock API実装済み、本番API準備中

2. 性能・拡張性要求

2.1 業務処理量

項番：B.1.1.1
大項目：性能・拡張性
中項目：業務処理量  
小項目：通常時の業務量
メトリクス：ユーザ数
現行システム非機能要求グレード：レベル1（1,000人程度の特定ユーザ）
新システム非機能要求グレード：レベル2（10,000人をベースに年増3%を想定）
確定状態：仮定

項番：B.1.1.2
メトリクス：同時アクセス数
現行システム非機能要求グレード：レベル1（同時接続50人を上限）
新システム非機能要求グレード：レベル2（段階的に2,500人まで拡張）
確定状態：確定

項番：B.1.1.3
メトリクス：データ量
現行システム非機能要求グレード：レベル1（SQLite 100MB/年/ユーザー、主要データ量のみ明確）
新システム非機能要求グレード：レベル1（同上、48テーブル構成で詳細設計済み）
確定状態：確定

項番：B.1.1.4
メトリクス：オンラインリクエスト件数
現行システム非機能要求グレード：レベル1（バイタルデータ同期100件/分、主要処理のみ）
新システム非機能要求グレード：レベル1（同上、1時間間隔自動同期）
確定状態：確定

2.2 業務量増大度

項番：B.1.2.1
メトリクス：ユーザ数増大率
現行システム非機能要求グレード：レベル0（1倍、開発段階）
新システム非機能要求グレード：レベル5（50倍、1,000名→50,000名の段階的拡張）
確定状態：計画

項番：B.1.2.2
メトリクス：同時アクセス数増大率
現行システム非機能要求グレード：レベル0（1倍）
新システム非機能要求グレード：レベル5（50倍、50名→2,500名同時接続）
確定状態：計画

項番：B.1.2.3
メトリクス：データ量増大率
現行システム非機能要求グレード：レベル0（1倍）
新システム非機能要求グレード：レベル5（50倍、100GB→5TB想定）
確定状態：計画

2.3 性能目標値

項番：B.2.1.1
中項目：性能目標値
小項目：オンラインレスポンス
メトリクス：通常時レスポンス順守率
現行システム非機能要求グレード：レベル3（90%、初回起動3秒以内、2回目以降1秒以内）
新システム非機能要求グレード：レベル3（90%、同上）
確定状態：確定

項番：B.2.1.2
メトリクス：ピーク時レスポンス順守率
現行システム非機能要求グレード：レベル2（80%、WebView画面遷移3秒以内）
新システム非機能要求グレード：レベル3（90%、通信最適化により改善）
確定状態：目標

項番：B.2.2.1
小項目：バッチレスポンス
メトリクス：通常時レスポンス順守度合い
現行システム非機能要求グレード：レベル1（バイタルデータ同期、所定時間内収束）
新システム非機能要求グレード：レベル2（再実行余裕確保、リトライ機能実装）
確定状態：確定

2.4 リソース拡張性

項番：B.3.1.1
中項目：リソース拡張性
小項目：CPU拡張性
メトリクス：CPU利用率
現行システム非機能要求グレード：レベル2（通常操作時50%以下を目標）
新システム非機能要求グレード：レベル2（同上、React Native最適化により達成）
確定状態：確定

項番：B.3.2.1
小項目：メモリ拡張性
メトリクス：メモリ利用率
現行システム非機能要求グレード：レベル2（アプリメモリ使用量200MB以下）
新システム非機能要求グレード：レベル2（同上、メモリリーク防止対策実装）
確定状態：確定

項番：B.3.3.1
小項目：ディスク拡張性
メトリクス：ディスク利用率
現行システム非機能要求グレード：レベル2（SQLite 100MB/年、空き容量1GB以上必要）
新システム非機能要求グレード：レベル2（同上、自動アーカイブ機能検討）
確定状態：確定

3. 各種処理方式性能設計

3.1 アプリケーション層性能設計

React Native 0.80.0ベースの性能最適化
- Navigation：@react-navigation（Stack + Drawer）による画面遷移最適化
- 状態管理：React Context + カスタムフック（useAuth, useGoalSafe）による効率化
- メモリ管理：画面遷移時のメモリリーク防止、未使用コンポーネント適切アンマウント

3.2 データレイヤー性能設計

SQLiteデータベース最適化
- WALモード採用によるリード・ライト分離
- パフォーマンス重視インデックス設計
  CREATE INDEX idx_vital_data_user_measurement ON vital_data(user_id, measurement_code, measured_start_at);
  CREATE INDEX idx_daily_steps_date ON daily_steps(date, user_id);
- 48テーブル構成による機能分離とクエリ性能向上

3.3 通信層性能設計

API通信最適化
- Mock API実装済み（本番API移行準備中）
- 30秒タイムアウト設定
- 指数バックオフによるリトライ機能（最大3回）
- バッチ処理による通信効率化（100件単位送信）

バイタルデータ同期方式
- 1時間間隔自動同期
- uploadVitalsBatch：100件/分の処理能力
- sync_statusフラグによる差分同期実装

3.4 外部連携性能設計

Firebase連携
- Remote Config：動的設定値のリアルタイム配信
- FCM：Push通知の確実な配信
- Analytics：性能監視とユーザー行動分析

HealthKit/ヘルスコネクト連携
- 1日分データ取得5秒以内
- 非同期取得によるUI非ブロック
- MockHealthPlatformService実装済み

4. 性能設計方針

4.1 基本設計方針

ローカルファースト設計
- SQLiteを主データストアとして、オフライン動作基本
- 同期は補助的機能として設計
- ユーザー体験の連続性最優先

段階的同期戦略
- 重要度による同期優先順位設定
- バックグラウンド同期とフォアグラウンド同期使い分け
- エラー発生時の段階的リトライ

4.2 技術選定方針

採用技術スタックの選定理由
- React Native 0.80.0：クロスプラットフォーム対応、開発効率、ネイティブ比90%性能
- SQLite：軽量、オフライン対応、トランザクション対応
- Firebase：Google提供、99.9%可用性、高信頼性
- TypeScript 5.0.4：型安全性、コード品質、JavaScript比20%開発効率向上

5. 必要HW製品スペック

5.1 モバイルデバイス要件

iOS端末要件
- OS：iOS 16.0以上（最新OSから3世代サポート）
- CPU：A12 Bionic以上（iPhone XS以降）
- RAM：3GB以上（メモリ使用量200MB考慮）
- ストレージ：64GB（空き1GB以上、アプリサイズ500MB + データ領域）
- 生体認証：Touch ID/Face ID（セキュリティ強化）

Android端末要件
- OS：Android 10.0 (API 29)以上
- CPU：Snapdragon 660相当以上
- RAM：4GB以上（Android OS利用メモリ考慮）
- ストレージ：64GB（空き1GB以上）
- ヘルスコネクト：対応必須（バイタルデータ取得）

5.2 開発・テスト環境要件

開発端末スペック
- React Native開発：macOS Ventura以降、Apple M1/M2、16GB RAM、512GB SSD
- Android開発：Windows 11/macOS、Intel i7/Apple M1、16GB RAM、512GB SSD

実機テスト環境
- iOS：iPhone 13/14/15、iPad（各世代1台以上）
- Android：Pixel 6/7/8、Galaxy S22/S23（各1台以上）
- 低スペック端末：iPhone SE、Pixel 6a（性能下限確認用）

6. 想定する拡張範囲

6.1 利用者数拡張シナリオ

段階的拡張計画
Phase 1（2025年度）：1,000名、50名同時、100GB、基本機能完成
Phase 2（2026年度）：5,000名、250名同時、500GB、AI健康アドバイス
Phase 3（2027年度）：10,000名、500名同時、1TB、ウェアラブル連携
Phase 4（2028年度）：50,000名、2,500名同時、5TB、企業横断健康管理

6.2 機能拡張範囲

プラットフォーム拡張
- Webアプリケーション：React.js + TypeScript実装、レスポンシブデザイン
- ウェアラブルデバイス対応：Apple Watch アプリ、Wear OS アプリ、リアルタイム監視

AI・機械学習機能
- 健康リスク予測：バイタルデータからの予測分析
- 異常値検出：早期警告システム
- パーソナライズ提案：生活改善アドバイス

6.3 地理的拡張

多地域対応計画
- 日本（現行）：Tokyo/Osaka、個人情報保護法対応
- 東南アジア（2026年）：Singapore、PDPA対応、多言語化
- 北米（2027年）：US-West、HIPAA対応、FDA承認検討
- 欧州（2028年）：Frankfurt、GDPR対応、CEマーキング

7. 拡張対策

7.1 アーキテクチャ拡張対策

マイクロサービス化戦略
Phase1：React Native + バイタルAWS単一API（現行）
Phase2：サービス分離（認証、バイタル管理、通知、外部連携）
Phase3：フルマイクロサービス（AI、分析、コンプライアンス追加）

データベース拡張戦略
- 読み書き分離：Master-Slave構成によるリード性能向上
- シャーディング：ユーザーIDベースパーティショニング
- キャッシュ：Redis Cluster、99.9%ヒット率

7.2 性能拡張対策

自動スケーリング設計
- 水平スケーリング：CPU 70%閾値、最小2レプリカ、最大20レプリカ
- 垂直スケーリング：リソース使用率80%閾値

キャッシュ戦略
- アプリ内キャッシュ：React Native Memory、30分TTL
- ローカルDB：SQLite、永続キャッシュ
- 分散キャッシュ：Redis Cluster、1時間TTL
- CDN：CloudFront、1日TTL

7.3 運用・保守拡張対策

監視・ログ強化
- リアルタイム監視：応答時間、エラー率、スループット
- アラート：Critical（5分以内）、Major（1時間以内）、Minor（日次）
- ログ集約：Fluent Bit、Elasticsearch、Kibana、90日保持

CI/CD拡張
- 開発環境：自動デプロイ、単体・統合・スモークテスト
- ステージング：手動デプロイ、E2E・性能テスト、QAチーム承認
- 本番環境：セキュリティスキャン・負荷テスト、多重承認、自動ロールバック

8. 検証計画

8.1 性能検証項目

アプリケーション性能テスト
- 起動時間テスト：初回3秒、2回目1秒以内（各OS・機種）
- メモリリークテスト：24時間連続稼働、200MB以下維持
- バッテリー消費テスト：各機能1時間連続、5%/時間以内
- データ同期性能テスト：10,000件一括同期、100件/分速度

負荷テスト
- 通常負荷：100ユーザー30分間、応答3秒以内・エラー1%以下
- ピーク負荷：500ユーザー10分間、応答5秒以内・エラー5%以下
- ストレステスト：1000ユーザー5分間、システム復旧可能・データ損失なし

8.2 拡張性検証項目

スケーラビリティテスト
- 水平スケール検証：サーバー台数増加による性能線形向上確認
- データ量スケール検証：年間データ蓄積での性能劣化確認（100MB/年）
- SQLiteクエリ性能の長期安定性確認

互換性テスト
- OSバージョン互換性：iOS/Android最新3世代での全機能正常動作
- デバイス互換性：推奨・最小スペック端末での性能要件達成
- APIバージョン互換性：バイタルAWS API下位互換性維持
- データ移行互換性：SQLiteスキーマ変更時のデータ損失なし

8.3 検証スケジュール

継続的検証サイクル
- 単体テスト：開発時、機能単位動作確認、テストカバレッジレポート
- 結合テスト：2週間、システム間連携確認、結合テスト結果報告書
- 性能テスト：1週間、非機能要求達成確認、性能テスト報告書
- 受入テスト：1週間、ビジネス要件達成確認、受入テスト報告書

9. まとめ

9.1 重要成功要因
1. 実装ベース現実的要求設定：既存実装を前提とした現実的性能目標
2. HDBシステム連携強化：WebView SSO連携安定化、バイタルAWS経由データ統合
3. 段階的拡張アプローチ：1,000名→50,000名への段階的スケール

9.2 リスク管理
- バイタルAWS API未完成：Mock API継続、段階移行でリスク軽減
- SQLite性能限界：分散DB移行計画でクエリ応答時間監視
- iOS/Android OS更新：3世代サポート維持でクラッシュ率監視
- セキュリティ脆弱性：OWASP準拠、定期診断で脆弱性スコア監視

9.3 継続改善計画
- 月次レビュー：性能KPI達成状況、ユーザーフィードバック分析
- 四半期改善：機能追加、性能最適化、セキュリティ強化
- 年次見直し：アーキテクチャ評価、技術スタック刷新検討

9.4 検証可能性保証
本検討書の全要求は以下により検証可能：
1. 定量的指標：数値目標と測定条件明確化
2. 実装根拠：実際コード・設計資料との紐付け
3. 測定ツール：Firebase Analytics、実機テスト環境
4. 継続監視：本番環境での常時モニタリング

---

承認者署名欄
- プロジェクトマネージャー：＿＿＿＿＿＿＿＿
- システムアーキテクト：＿＿＿＿＿＿＿＿
- 技術責任者：＿＿＿＿＿＿＿＿
- QA責任者：＿＿＿＿＿＿＿＿

改版履歴
版数：3.0、改版日：2025-08-08、改版内容：HDB実装実態に基づく全面改定、改版者：開発チーム