# 結合テスト観点表

## 1. 画面遷移・ナビゲーション結合テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **認証フロー** | スプラッシュ→ログイン | 初回起動 | 未ログイン時にログイン画面へ遷移すること | 高 | |
| | | ログイン済み | トークン有効時にメイン画面へ遷移すること | 高 | |
| | ログイン→WebView→メイン | WebView起動 | ログインボタンでWebViewが開くこと | 高 | |
| | | 外部認証 | WebView内で外部システムの認証画面が表示されること | 高 | |
| | | 認証成功 | WebViewから認証トークンを受け取りメイン画面へ遷移 | 高 | |
| | | 認証失敗 | WebView内でエラー表示後、アプリ側でも処理 | 高 | |
| | | トークン保存 | WebViewから受け取ったトークンが保存されること | 高 | |
| **メインナビゲーション** | ドロワーナビゲーション | メニュー開閉 | ドロワーメニューの開閉が正しく動作すること | 高 | |
| | | 画面遷移 | 各メニュー項目から正しい画面へ遷移すること | 高 | |
| | | バックボタン | Android端末でバックボタンが正しく動作すること | 高 | Android固有 |
| | スタックナビゲーション | 画面スタック | 画面遷移履歴が正しく管理されること | 高 | |
| | | ディープリンク | Push通知からの画面遷移が正しいこと | 中 | |
| **WebView連携** | WebView画面遷移 | SSO認証 | アプリのトークンを使ってWebViewでSSO認証 | 高 | |
| | | JavaScript Bridge | WebViewとアプリ間のデータ受け渡し | 高 | |
| | | postMessage | WebViewからアプリへのメッセージ送信 | 高 | |
| | | Cookie共有 | 認証情報のCookie管理 | 中 | |
| | | エラー処理 | WebView読み込みエラー時の処理 | 高 | |

## 2. データフロー結合テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **バイタルデータフロー** | 健康データ取得→表示 | HealthKit連携 | HealthKitからデータ取得→画面表示まで | 高 | iOS |
| | | Google Fit連携 | Google Fitからデータ取得→画面表示まで | 高 | Android |
| | | データ変換 | プラットフォーム固有データの共通形式変換 | 高 | |
| | 手動入力→保存 | 入力画面連携 | ダイアログ入力→DB保存→一覧更新 | 高 | |
| | | バリデーション | 入力値検証→エラー表示の連携 | 高 | |
| | データ同期 | ローカル→サーバー | アプリ内DB→モックAPIへの同期テスト | 高 | モックAPI使用 |
| | | 競合解決 | オフライン編集データの同期処理 | 高 | |
| | | 同期状態表示 | 同期中/完了の状態表示更新 | 中 | |
| **認証データフロー** | ログイン→API呼び出し | トークン連携 | 認証トークンを使用したモックAPI呼び出し | 高 | モックAPI使用 |
| | | トークン更新 | トークン期限切れ時の自動更新 | 高 | モック実装 |
| | | セッション管理 | アプリ再起動時のセッション復元 | 高 | |

## 3. サービス間結合テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **DB-API連携** | DatabaseService↔ApiClient | データ同期 | ローカルDBとモックAPIの連携テスト | 高 | モックAPI使用 |
| | | オフライン対応 | オフライン時のデータ蓄積と同期 | 高 | |
| | | エラーリトライ | 同期失敗時の再試行メカニズム | 中 | |
| **通知連携** | Firebase→NotificationService | Push通知受信 | Firebase通知の受信と表示 | 高 | |
| | | フォアグラウンド | アプリ起動中の通知処理 | 高 | |
| | | バックグラウンド | アプリ非起動時の通知処理 | 高 | |
| | | データ連携 | 通知データを使用した画面遷移 | 中 | |
| **バックアップ連携** | DB→クラウドストレージ | Google Oneバックアップ | Androidでのバックアップ処理 | 高 | Android |
| | | iCloudバックアップ | iOSでのバックアップ処理 | 高 | iOS |
| | | リストア | バックアップからのデータ復元 | 高 | |

## 4. 非機能要件結合テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **性能** | 画面遷移性能 | レスポンス時間 | 各画面遷移が3秒以内（90%ile） | 高 | |
| | | メモリ使用量 | 画面遷移時のメモリリーク確認 | 高 | |
| | データ処理性能 | 大量データ表示 | 1000件のバイタルデータ表示性能 | 中 | |
| | | スクロール性能 | リスト画面のスムーズなスクロール | 高 | |
| **オフライン対応** | ネットワーク切断 | 基本機能 | オフライン時の基本機能動作確認 | 高 | |
| | | データ保存 | オフライン時のデータ保存動作 | 高 | |
| | | 復帰処理 | オンライン復帰時の自動同期 | 高 | |
| **セキュリティ** | 認証連携 | セッション管理 | 複数画面でのセッション共有 | 高 | |
| | | 自動ログアウト | 一定時間操作なしでのログアウト | 中 | |
| | データ暗号化 | 通信暗号化 | API通信のTLS暗号化確認 | 高 | |
| | | ローカル暗号化 | 重要データの暗号化保存確認 | 高 | |

## 5. エラーハンドリング結合テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **ネットワークエラー** | API通信エラー | タイムアウト | API呼び出しタイムアウト時の処理 | 高 | |
| | | 接続エラー | ネットワーク未接続時のエラー表示 | 高 | |
| | | HTTPエラー | 各種HTTPステータスコードの処理 | 高 | |
| **データエラー** | 不整合データ | データ競合 | 同期時のデータ競合解決 | 高 | |
| | | 破損データ | 破損データ検出時の処理 | 中 | |
| **権限エラー** | 権限不足 | HealthKit権限 | 権限拒否時の代替処理 | 高 | iOS |
| | | 通知権限 | 通知権限拒否時の処理 | 中 | |
| | | カメラ権限 | カメラ権限拒否時の処理 | 低 | 将来機能 |

## 6. 転籍・移行結合テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **転籍処理** | 転籍フロー | ユーザー認証 | 転籍前後のユーザー認証処理 | 高 | モックAPI使用 |
| | | データ移行 | バイタルデータの正確な移行 | 高 | モック移行処理 |
| | | 進捗表示 | 移行処理の進捗表示更新 | 中 | |
| **機種変更** | データ移行 | バックアップ | 旧端末でのバックアップ処理 | 高 | |
| | | リストア | 新端末でのリストア処理 | 高 | |
| | | データ整合性 | 移行前後のデータ一致確認 | 高 | |

## 7. WebView統合テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **WebView表示** | 各種Web画面 | お知らせ画面 | WebView経由での正常表示 | 高 | |
| | | 利用規約 | 長文コンテンツの表示確認 | 中 | |
| | | FAQ | インタラクティブコンテンツ動作 | 中 | |
| | | 健診結果 | 外部システムのデータ表示 | 高 | |
| **ログイン認証** | WebView認証 | 初回ログイン | WebViewでの外部システムログイン | 高 | |
| | | トークン受信 | JavaScript Bridgeでのトークン受け渡し | 高 | |
| | | 認証エラー | 外部システムでの認証失敗処理 | 高 | |
| | | タイムアウト | WebView読み込みタイムアウト | 高 | |
| **認証連携** | SSO認証 | 自動ログイン | 取得済みトークンでのSSO動作 | 高 | |
| | | セッション維持 | WebViewセッションの維持管理 | 高 | |
| | | トークン更新 | 期限切れトークンの更新処理 | 高 | |
| **エラー処理** | 読み込みエラー | ネットワークエラー | WebView読み込み失敗時の処理 | 高 | |
| | | JavaScriptエラー | JS実行エラー時の処理 | 中 | |
| | | 認証エラー | 外部システム認証エラーの処理 | 高 | |

## テスト環境要件

| 項目 | 要件 | 備考 |
|------|------|------|
| テスト端末 | iOS実機/シミュレータ | iOS 16以降 |
| | Android実機/エミュレータ | Android 10以降 |
| ネットワーク環境 | Wi-Fi/4G/5G | 各種ネットワーク環境 |
| | オフライン | 機内モード等 |
| テストデータ | 本番相当データ | 1000件以上のバイタルデータ |
| 外部サービス | Firebase | Push通知テスト用 |
| | HealthKit/Google Fit | 実機での動作確認 |
| APIモック | モックサーバー | 全API通信をモック化 |