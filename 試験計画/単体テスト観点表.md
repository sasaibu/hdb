# 単体テスト観点表

## 1. コンポーネント単体テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **画面コンポーネント** | スプラッシュ画面 | 初期表示 | ロゴが正しく表示されること | 高 | |
| | | Firebase設定取得 | Firebase Remote Configから設定が取得できること | 高 | モック化して検証 |
| | | デバイス情報登録 | デバイス情報が正しく送信されること | 高 | |
| | | 画面遷移 | 初期化完了後にログイン画面へ遷移すること | 高 | |
| | ログイン画面 | WebView起動 | ログインボタンタップでWebViewが起動すること | 高 | |
| | | URL設定 | 正しい認証URLがWebViewに設定されること | 高 | |
| | | WebView表示 | WebView内でログイン画面が正しく表示されること | 高 | |
| | | JavaScript Bridge | WebViewからアプリへのトークン受け渡し | 高 | |
| | | トークン保存 | 受け取ったトークンがAsyncStorageに保存されること | 高 | |
| | | エラーハンドリング | WebView読み込みエラー時の処理 | 高 | |
| | バイタルデータ表示画面 | データ表示 | 歩数、血圧、体重等のデータが正しく表示されること | 高 | |
| | | グラフ描画 | グラフコンポーネントが正しく描画されること | 中 | |
| | | 空データ処理 | データがない場合の表示が正しいこと | 高 | |
| | バイタル入力ダイアログ | 日付入力 | DatePickerが正しく動作すること | 高 | |
| | | 時刻入力 | TimePickerが正しく動作すること | 高 | |
| | | 数値入力 | 各種バイタルデータの入力制限が正しいこと | 高 | |
| | | 入力値検証 | 異常値（範囲外）の入力を防げること | 高 | |
| **共通コンポーネント** | Button | タップ処理 | onPressが正しく呼ばれること | 高 | |
| | | 無効化状態 | disabled時にタップできないこと | 中 | |
| | | スタイル | 各状態でのスタイルが正しく適用されること | 低 | |
| | Card | レイアウト | 子要素が正しく配置されること | 中 | |
| | | スタイル | 影やボーダーが正しく表示されること | 低 | |
| | Input | 入力処理 | テキスト入力が正しく動作すること | 高 | |
| | | プレースホルダー | プレースホルダーが正しく表示されること | 低 | |
| | | エラー表示 | エラー時のスタイルが正しく適用されること | 中 | |
| | WebViewコンポーネント | URL読み込み | 指定URLが正しく読み込まれること | 高 | |
| | | JavaScript注入 | JavaScriptコードが正しく実行されること | 高 | |
| | | メッセージ受信 | postMessageでのデータ受信 | 高 | |
| | | エラー処理 | 読み込みエラー時の画面表示 | 高 | |
| | | ナビゲーション制御 | 戻る/進む動作の制御 | 中 | |

## 2. サービス層単体テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **データベースサービス** | DatabaseService | DB初期化 | テーブルが正しく作成されること | 高 | ローカルSQLite |
| | | データ挿入 | INSERTクエリが正しく実行されること | 高 | |
| | | データ取得 | SELECTクエリが正しく取得されること | 高 | |
| | | データ更新 | UPDATEクエリが正しく実行されること | 高 | |
| | | データ削除 | DELETEクエリが正しく実行されること | 高 | |
| | | トランザクション | トランザクション処理が正しく動作すること | 高 | |
| | | エラーハンドリング | DB操作エラーが適切に処理されること | 高 | |
| **バイタルデータサービス** | VitalDataService | データ保存 | バイタルデータがローカルDBに保存されること | 高 | |
| | | データ取得 | 指定期間のデータが正しく取得できること | 高 | |
| | | データ集計 | 平均値、最大値等が正しく計算されること | 高 | |
| | | データ検証 | 入力値の妥当性チェックが動作すること | 高 | |
| **API通信サービス** | ApiClient | モックAPI通信 | モックAPIへのリクエストが正しく送信されること | 高 | モック使用 |
| | | ヘッダー設定 | 認証トークンが正しく設定されること | 高 | |
| | | レスポンス処理 | モックレスポンスが正しく処理されること | 高 | |
| | | タイムアウト | タイムアウト処理が正しく動作すること | 中 | |
| | | エラーハンドリング | HTTPエラーが適切に処理されること | 高 | モックエラー |
| **通知サービス** | NotificationService | ローカル通知 | 通知が正しくスケジュールされること | 高 | |
| | | 通知権限 | 権限確認処理が正しく動作すること | 高 | |
| | | Push通知処理 | 受信した通知の処理が正しいこと | 高 | モック通知 |
| | | 通知タップ | 通知タップ時の画面遷移が正しいこと | 中 | |
| **同期サービス** | SyncService | データ準備 | 同期対象データの抽出が正しいこと | 高 | |
| | | 同期リクエスト | モックAPIへの同期リクエスト生成 | 高 | モック使用 |
| | | 同期結果処理 | モック同期結果の反映が正しいこと | 高 | |
| | | 競合解決 | データ競合時の解決ロジックが正しいこと | 高 | |
| | | 差分検出 | 変更データの検出が正しいこと | 高 | |

## 3. カスタムフック単体テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **認証フック** | useAuth | ログイン処理 | loginメソッドが正しく動作すること | 高 | |
| | | ログアウト処理 | logoutメソッドが正しく動作すること | 高 | |
| | | 認証状態管理 | isAuthenticatedの状態が正しく更新されること | 高 | |
| | | トークン管理 | トークンの保存・削除が正しく動作すること | 高 | |

## 4. ユーティリティ関数単体テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **日付処理** | formatDate | 日付フォーマット | 各種日付形式が正しく変換されること | 中 | |
| | | タイムゾーン | タイムゾーン処理が正しいこと | 高 | |
| **データ変換** | convertHealthData | HealthKit変換 | HealthKitデータが正しく変換されること | 高 | iOS固有 |
| | | Google Fit変換 | Google Fitデータが正しく変換されること | 高 | Android固有 |
| **バリデーション** | validateVitalData | 範囲チェック | 各バイタルデータの正常範囲チェック | 高 | |
| | | 型チェック | データ型の検証が正しいこと | 高 | |

## 5. プラットフォーム固有機能単体テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **iOS固有** | HealthKit連携 | 権限要求 | HealthKit権限要求が正しく動作すること | 高 | iOSのみ |
| | | データ読み取り | 歩数、心拍数等が取得できること | 高 | iOSのみ |
| | | データ書き込み | バイタルデータが保存できること | 高 | iOSのみ |
| **Android固有** | Google Fit連携 | 権限要求 | Google Fit権限要求が正しく動作すること | 高 | Androidのみ |
| | | データ読み取り | 歩数、心拍数等が取得できること | 高 | Androidのみ |
| | | SensorManager | 歩数センサーからデータ取得できること | 高 | Androidのみ |

## 6. エラーハンドリング単体テスト

| 分類 | テスト対象 | テスト観点 | 確認項目 | 優先度 | 備考 |
|------|------------|------------|----------|--------|------|
| **エラー境界** | ErrorBoundary | エラーキャッチ | 子コンポーネントのエラーをキャッチできること | 高 | |
| | | フォールバックUI | エラー時の代替UIが表示されること | 高 | |
| | | エラーロギング | エラー情報がログに記録されること | 中 | |
| **例外処理** | try-catch | 非同期エラー | async/awaitのエラーが適切に処理されること | 高 | |
| | | Promise rejection | Promiseのrejectionが処理されること | 高 | |

## 7. モックAPI仕様

| API種別 | モック対象 | テストケース | 優先度 | 備考 |
|---------|-----------|-------------|--------|------|
| **認証WebView** | WebView認証 | 認証成功コールバック | 高 | トークン受信 |
| | | 認証失敗コールバック | 高 | エラー処理 |
| | | WebViewタイムアウト | 高 | 読み込み失敗 |
| | | JavaScript実行エラー | 中 | Bridge失敗 |
| | トークン検証 | 有効トークン | 高 | モックAPI |
| | | 無効トークン | 高 | モックAPI |
| **バイタルデータAPI** | データ取得 | 正常データ | 高 | |
| | | 空データ | 高 | |
| | | 大量データ | 中 | 1000件以上 |
| | データ送信 | 成功レスポンス | 高 | |
| | | バリデーションエラー | 高 | 400エラー |
| | | サーバーエラー | 中 | 500エラー |
| **通知API** | デバイス登録 | 成功 | 高 | |
| | | 登録済みエラー | 中 | |
| **転籍API** | 転籍認証 | 成功 | 高 | |
| | | 権限エラー | 高 | |
| | データ移行状態 | 進行中 | 高 | |
| | | 完了 | 高 | |

## テスト環境要件

| 項目 | 要件 | 備考 |
|------|------|------|
| テストフレームワーク | Jest | React Native標準 |
| モック化 | React Native Testing Library | コンポーネントテスト用 |
| APIモック | MSW (Mock Service Worker) | API通信のモック化 |
| カバレッジ目標 | 80%以上 | 重要機能は90%以上 |
| CI/CD統合 | GitHub Actions | 自動テスト実行 |
| テストデータ | ローカルファイル | JSON形式で管理 |